const B=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const w of h.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&r(w)}).observe(document,{childList:!0,subtree:!0});function o(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerpolicy&&(h.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?h.credentials="include":n.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(n){if(n.ep)return;n.ep=!0;const h=o(n);fetch(n.href,h)}};B();document.querySelector("#app").innerHTML=`
    <div class="game-over">
        Game Over
    </div>
    <div>
        <section class="widget">
            <div class="player-hp"><div class="player-hp-real"></div></div>
            <div class="timer">100</div>
            <div class="enemy-hp"><div class="enemy-hp-real"></div></div>
        </section>
        <canvas id="main-game"></canvas>
    </div>
`;const e=document.getElementById("main-game"),p=e.getContext("2d"),v=new Image;v.src="./images/background.png";const d=new Image;d.src="./images/shop.png";const A=document.querySelector(".player-hp-real"),b=document.querySelector(".enemy-hp-real"),m=document.querySelector(".game-over"),l=document.querySelector(".timer");let g=0;e.width=window.innerWidth;e.height=window.innerHeight;p.drawImage(v,0,0,e.width,e.height+156);p.drawImage(d,118*g,0,118,128,e.width*3/4-118,e.height,118,128);const c=10,E=50,_=1e3/E;let k=0,J=0,M=5,j=0,a=[];class u{constructor({position:t,velocity:o,color:r="red",name:n}){this.name=n,this.position=t,this.velocity=o,this.height=150,this.width=50,this.color=r,this.jump="endJump",this.direction="right",this.frame={x:0,y:0},this.attackBox={position:this.position,width:200,height:50},this.isAttack=!1,this.hitPoint=100,this.frameHold=5,this.frameElapsed=0,this.lastState="Idle",this.images={Idle_right:{image:new Image,imageSrc:`images/${this.name}/Idle_${this.direction}.png`,state:"Idle"},Run_right:{image:new Image,imageSrc:`images/${this.name}/Run_${this.direction}.png`,state:"Run"},Attack1_right:{image:new Image,imageSrc:`images/${this.name}/Attack1_${this.direction}.png`,state:"Attack1"},Jump_right:{image:new Image,imageSrc:`images/${this.name}/Jump_${this.direction}.png`,state:"Jump"},Fall_right:{image:new Image,imageSrc:`images/${this.name}/Fall_${this.direction}.png`,state:"Fall"}};for(var h in this.images)this.images[h].image.src=this.images[h].imageSrc,this.images[new String(this.images[h].state)+"_left"]={image:new Image,imageSrc:`images/${this.name}/${this.images[h].state}_left.png`},this.images[new String(this.images[h].state)+"_left"].image.src=this.images[new String(this.images[h].state)+"_left"].imageSrc}draw(t="Idle",o){p.fillStyle=this.color;var r=0;this.isAttack?r=this.name=="samuraiMack"?6:4:t=="Jump"||t=="Fall"?r=2:t=="Run"?r=(this.name=="samuraiMack",8):r=this.name=="samuraiMack"?8:4;var n=this.images[t+"_"+this.direction].image;if(this.lastState!==t&&(this.direction==="right"?this.frame.x=0:this.frame.x=r-1,this.lastState=t),p.drawImage(n,this.frame.x*n.width/r,0,n.width/r,n.height,this.position.x-(this.direction=="right"?250:200),this.position.y-50*(this.width*10/this.height)+(this.name=="samuraiMack"?10:0),this.width*10,this.height*(this.width*10/this.height)),this.frameElapsed++,this.frameElapsed%this.frameHold===0){if(this.direction==="right"&&this.frame.x<r-1)this.frame.x++;else if(this.direction==="left"&&this.frame.x>0)this.frame.x--;else if(this.direction==="right"?this.frame.x=0:this.frame.x=r-1,this.isAttack){this.isAttack=!1;var h=this.name=="samuraiMack"?b:A;(this.attackBox.position.x<o.position.x+o.width&&this.attackBox.position.x+this.attackBox.width>o.position.x&&this.attackBox.position.y<o.position.y+o.height&&this.attackBox.position.y+this.attackBox.height>o.position.y&&this.direction==="right"||this.attackBox.position.x-this.attackBox.width+this.width<o.position.x+o.width&&this.attackBox.position.x-this.attackBox.width+this.width+this.attackBox.width>o.position.x&&this.attackBox.position.y<o.position.y+o.height&&this.attackBox.position.y+this.attackBox.height>o.position.y&&this.direction==="left")&&(h.offsetWidth-document.querySelector(`${this.name=="samuraiMack"?".enemy-hp":".player-hp"}`).offsetWidth*10/100>0?h.style.width=h.offsetWidth-document.querySelector(".enemy-hp").offsetWidth*10/100+"px":(h.style.width=0+"px",L(`Player ${this.name=="samuraiMack"?1:2} win 
 press Q to play again.`)))}this.frameElapsed=0}}attack(t){this.isAttack&&this.draw("Attack1",t)}update(){!a[87]&&!a[68]&&!a[65]&&!a[32]&&this.jump=="endJump"&&!this.isAttack&&this.draw();var t=this.velocity.x,o=this.velocity.y;a[87]&&!this.isAttack&&this.jump=="endJump"&&(this.jump="startJump"),this.jump=="startJump"&&(o=this.velocity.y<0?this.velocity.y:-this.velocity.y,this.position.y+=o,this.draw("Jump")),this.position.y+this.height+c>e.height?o=0:this.position.y+o<=400&&this.jump=="startJump"?(o=0,this.jump="onJump"):this.jump=="onJump"&&(this.draw("Fall"),this.position.y+this.height+c+o>=e.height&&(this.jump="endJump")),this.position.y+=c,this.position.y+this.height>=e.height&&(this.position.y=e.height-this.height),a[68]&&!this.isAttack?(t=Math.abs(this.velocity.x),this.direction="right",this.jump=="endJump"&&!this.isAttack&&this.draw("Run")):a[65]&&!this.isAttack&&(t=-this.velocity.x,this.direction="left",this.jump=="endJump"&&!this.isAttack&&this.draw("Run")),(!a[68]&&!a[65]||this.position.x+t<0||this.position.x+t+this.width>e.width)&&(t=0),this.isAttack||(this.position.x+=t)}}let f=new u({position:{x:e.width/4-50,y:e.height-200},velocity:{x:10,y:30},color:"blue",name:"samuraiMack"}),i=new u({position:{x:e.width*3/4-50,y:e.height-200},velocity:{x:10,y:30},color:"red",name:"kenji"});i.update=()=>{!a[38]&&!a[39]&&!a[37]&&!a[13]&&i.jump=="endJump"&&!i.isAttack&&i.draw();var s=i.velocity.x,t=i.velocity.y;a[38]&&!i.isAttack&&i.jump=="endJump"&&(i.jump="startJump"),i.jump=="startJump"&&(i.draw("Jump"),t=i.velocity.y<0?i.velocity.y:-i.velocity.y,i.position.y+=t),i.position.y+i.height+c>e.height?t=0:i.position.y+t<=400&&i.jump=="startJump"?(t=0,i.jump="onJump"):i.jump=="onJump"&&(i.position.y+i.height+c+t>=e.height&&(i.jump="endJump"),i.draw("Fall")),i.position.y+=c,i.position.y+i.height>=e.height&&(i.position.y=e.height-i.height),a[39]&&!i.isAttack?(i.jump=="endJump"&&i.draw("Run"),s=Math.abs(i.velocity.x),i.direction="right"):a[37]&&!i.isAttack&&(i.jump=="endJump"&&i.draw("Run"),s=-i.velocity.x,i.direction="left"),(!a[39]&&!a[37]||i.position.x+s<0||i.position.x+s+i.width>e.width)&&(s=0),i.isAttack||(i.position.x+=s)};function I(s){var t=s-J,o=s-k;o>=1e3&&(parseInt(l.innerText)>0&&(l.innerText=new String(parseInt(l.innerText)-1)),k=s,l.innerText==="0"&&L(`Draw 
 press Q to play again.`)),t>_&&(j++,p.clearRect(0,0,e.width,e.height),p.drawImage(v,0,0,e.width,e.height+150),p.drawImage(d,g*d.width/6,0,d.width/6,d.height,e.width*3/5,e.height-d.height*(d.width/6*4/d.height)-5,d.width/6*4,d.height*(d.width/6*4/d.height)),j%M===0&&(g<5?g++:g=0),f.update(),f.attack(i),i.update(),i.attack(f),J=s),window.requestAnimationFrame(I)}I(0);window.addEventListener("keydown",x);function x(s){s.keyCode!==32&&s.keyCode!==13&&(a[s.keyCode]=!0)}window.addEventListener("keyup",y);function y(s){delete a[s.keyCode],s.keyCode===81&&m.classList.contains("active")&&(m.classList.remove("active"),S()),(s.keyCode===32||s.keyCode===13)&&(s.keyCode===13&&(i.isAttack=!0),s.keyCode===32&&(f.isAttack=!0))}function S(){a=[],window.removeEventListener("keyup",y),window.addEventListener("keydown",x),window.addEventListener("keyup",y),f=new u({position:{x:e.width/4-50,y:e.height-200},velocity:{x:10,y:30},color:"blue",name:"samuraiMack"}),i=new u({position:{x:e.width*3/4-50,y:e.height-200},velocity:{x:10,y:30},color:"red",name:"kenji"}),i.update=()=>{!a[38]&&!a[39]&&!a[37]&&!a[13]&&i.jump=="endJump"&&!i.isAttack&&i.draw();var s=i.velocity.x,t=i.velocity.y;a[38]&&!i.isAttack&&i.jump=="endJump"&&(i.jump="startJump"),i.jump=="startJump"&&(t=i.velocity.y<0?i.velocity.y:-i.velocity.y,i.position.y+=t,i.draw("Jump")),i.position.y+i.height+c>e.height?t=0:i.position.y+t<=400&&i.jump=="startJump"?(t=0,i.jump="onJump"):i.jump=="onJump"&&(i.position.y+i.height+c+t>=e.height&&(i.jump="endJump"),i.draw("Fall")),i.position.y+=c,i.position.y+i.height>=e.height&&(i.position.y=e.height-i.height),a[39]&&!i.isAttack?(s=Math.abs(i.velocity.x),i.direction="right",i.jump=="endJump"&&i.draw("Run")):a[37]&&!i.isAttack&&(s=-i.velocity.x,i.direction="left",i.jump=="endJump"&&i.draw("Run")),(!a[39]&&!a[37]||i.position.x+s<0||i.position.x+s+i.width>e.width)&&(s=0),i.isAttack||(i.position.x+=s)},l.innerText="100",A.style.width="100%",b.style.width="100%"}function L(s){window.removeEventListener("keydown",x),window.removeEventListener("keyup",y),window.addEventListener("keyup",t=>{t.keyCode===81&&m.classList.contains("active")&&(m.classList.remove("active"),S())}),m.innerText=s,m.classList.add("active")}
